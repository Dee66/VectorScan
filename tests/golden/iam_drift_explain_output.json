{
  "status": "PASS",
  "file": "tests/fixtures/tfplan_iam_drift.json",
  "violations": [],
  "violations_struct": [],
  "counts": {
    "violations": 0
  },
  "checks": [
    "P-SEC-001",
    "P-FIN-001"
  ],
  "vectorscan_version": "0.1.0",
  "policy_version": "1.0.0",
  "schema_version": "1.2.0",
  "policy_pack_hash": "126aca2e973a5b2d4e18b3d4e078d645893409a809ebc1940bdb356c8b6ce87c",
  "policy_errors": [],
  "violation_severity_summary": {
    "critical": 0,
    "high": 0,
    "medium": 0,
    "low": 0
  },
  "policy_source_url": "https://github.com/Dee66/VectorScan/tree/main/tools/vectorscan/policies",
  "policy_manifest": {
    "policy_version": "1.0.0",
    "policy_pack_hash": "126aca2e973a5b2d4e18b3d4e078d645893409a809ebc1940bdb356c8b6ce87c",
    "policy_source_url": "https://github.com/Dee66/VectorScan/tree/main/tools/vectorscan/policies",
    "policy_count": 2,
    "policies": [
      {
        "id": "P-FIN-001",
        "name": "Mandatory Tagging",
        "severity": "high",
        "category": "finops",
        "description": "Taggable AWS resources must include CostCenter and Project tags."
      },
      {
        "id": "P-SEC-001",
        "name": "Encryption Mandate",
        "severity": "critical",
        "category": "security",
        "description": "RDS resources must enable storage encryption and reference a kms_key_id."
      }
    ],
    "signature": "sha256:bdd7820ee169f78660c992e699d108b992b5b067aa459e25873e0ecca8503cea",
    "signed": true,
    "verified": true,
    "path": "embedded"
  },
  "violation_count_by_severity": {
    "critical": 0,
    "high": 0,
    "medium": 0,
    "low": 0
  },
  "environment": {
    "platform": "linux",
    "platform_release": "unit-kernel",
    "python_version": "3.11.test",
    "python_implementation": "CPython",
    "terraform_version": "not-run",
    "terraform_source": "not-run",
    "vectorscan_version": "0.1.0",
    "strict_mode": false,
    "offline_mode": false
  },
  "plan_metadata": {
    "resource_count": 1,
    "resource_types": {
      "aws_rds_cluster": 1
    },
    "providers": [
      "aws"
    ],
    "module_count": 1,
    "modules": {
      "root": "root",
      "with_resources": 1,
      "child_module_count": 0,
      "has_child_modules": false
    },
    "exceeds_threshold": false,
    "change_summary": {
      "adds": 1,
      "changes": 0,
      "destroys": 0
    },
    "resources_by_type": {
      "aws_rds_cluster": {
        "planned": 1,
        "adds": 0,
        "changes": 0,
        "destroys": 0
      },
      "aws_iam_policy": {
        "planned": 0,
        "adds": 1,
        "changes": 0,
        "destroys": 0
      }
    },
    "file_size_mb": 0.000957,
    "parser_mode": "streaming",
    "file_size_bytes": 957,
    "parse_duration_ms": 123,
    "plan_slo": {
      "observed": {
        "resource_count": 1,
        "parse_duration_ms": 123,
        "file_size_bytes": 957
      },
      "thresholds": {
        "fast_path": {
          "max_resources": 1000,
          "max_parse_ms": 200
        },
        "large_plan": {
          "max_resources": 10000,
          "max_parse_ms": 2000
        },
        "file_size_limit_bytes": 1500000000
      },
      "active_window": "fast_path",
      "breach_reason": null
    }
  },
  "suspicious_defaults": [],
  "smell_report": {
    "level": "low",
    "summary": "No structural smells detected.",
    "stats": {
      "resource_count": 1,
      "max_module_depth": 0,
      "for_each_instances": 0,
      "kms_missing": 0,
      "iam_policy_statements": 1,
      "iam_policy_actions": 2,
      "iam_policy_length": 147,
      "change_total": 1
    },
    "smells": []
  },
  "iam_drift_report": {
    "status": "FAIL",
    "counts": {
      "risky_changes": 1
    },
    "items": [
      {
        "resource_type": "aws_iam_policy",
        "resource_name": "app_policy",
        "change": [
          "create"
        ],
        "risky_additions": [
          "iam:PassRole",
          "s3:DeleteObject"
        ],
        "severity_by_action": {
          "iam:PassRole": "high",
          "s3:DeleteObject": "high"
        },
        "notaction_broad_allow": false
      }
    ],
    "notes": {
      "limitations": [
        "NotAction not evaluated",
        "Resource scoping not evaluated for drift risk"
      ]
    }
  },
  "metrics": {
    "eligible_checks": 2,
    "passed_checks": 2,
    "compliance_score": 80,
    "network_exposure_score": 100,
    "open_sg_count": 0,
    "iam_risky_actions": 0,
    "notes": {
      "open_security_groups": [],
      "iam_risky_details": [],
      "violation_count": 0
    },
    "iam_drift": {
      "status": "FAIL",
      "risky_change_count": 1
    },
    "scan_duration_ms": 123,
    "parser_mode": "streaming",
    "resource_count": 1
  },
  "plan_risk_profile": "high",
  "plan_risk_factors": [
    "IAM drift detected risky changes"
  ],
  "security_grade": "B",
  "explanation": {
    "summary": "PASS scan â€“ compliance score 80/100, severity counts [critical=0, high=0, medium=0, low=0], IAM drift FAIL (1 risky change)",
    "plan_overview": {
      "narrative": "Plan defines 1 resource across 1 module (providers: aws; modules with resources: 1; no child modules).",
      "resource_count": 1,
      "module_count": 1,
      "providers": [
        "aws"
      ],
      "modules_with_resources": 1,
      "child_module_count": 0,
      "has_child_modules": false,
      "smell_summary": "No structural smells detected.",
      "smell_level": "low"
    },
    "scores": {
      "compliance_score": 80,
      "network_exposure_score": 100,
      "iam_risky_actions": 0,
      "eligible_checks": 2,
      "passed_checks": 2
    },
    "risk_highlights": [],
    "iam_drift": {
      "summary": "IAM drift FAIL (1 risky change).",
      "status": "FAIL",
      "risky_change_count": 1
    },
    "recommendations": [
      "Plan currently satisfies P-FIN-001 Mandatory Tagging, P-SEC-001 Encryption Mandate; maintain encryption and tagging coverage as modules evolve."
    ],
    "policy_context": [
      {
        "policy_id": "P-FIN-001",
        "name": "Mandatory Tagging",
        "severity": "high",
        "description": "Taggable AWS resources must include CostCenter and Project tags."
      },
      {
        "policy_id": "P-SEC-001",
        "name": "Encryption Mandate",
        "severity": "critical",
        "description": "RDS resources must enable storage encryption and reference a kms_key_id."
      }
    ],
    "plan_smells": {
      "level": "low",
      "summary": "No structural smells detected.",
      "stats": {
        "resource_count": 1,
        "max_module_depth": 0,
        "for_each_instances": 0,
        "kms_missing": 0,
        "iam_policy_statements": 1,
        "iam_policy_actions": 2,
        "iam_policy_length": 147,
        "change_total": 1
      },
      "smells": []
    }
  }
}
